<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>ELITR Online Text Flow</title>
    <style>
      .row {
        display: flex;
      }

      .column {
        flex: 50%;
      }

      .complete {
        color: black;
      }

      .expected {
        color: grey;
      }

      .incoming {
        color: red;
      }

      ol.reverse {
        display: flex;
        flex-direction: column-reverse;
      }

      li {
        flex: 0 0 auto;
      }
    </style>
  </head>
  <body>

    <div class="row">

      <div class="column">
        <h1>EN</h1>

        <h2>text</h2>
        <div id="text-en"><p><em>no events yet</em></p></div>

        <h2>flow</h2>
        <div id="flow-en"></div>

        <h2>data</h2>
        <div id="data-en"/></div>
      </div>

      <div class="column">
        <h1>CS</h1>

        <h2>text</h2>
        <div id="text-cs"><p><em>no events yet</em></p></div>

        <h2>flow</h2>
        <div id="flow-cs"></div>

        <h2>data</h2>
        <div id="data-cs"></div>
      </div>

    </div>

    <script>
      var events = new EventSource("{{ data }}");

      var listen = function (kind) {
        var text = document.getElementById("text-" + kind);
        var flow = document.getElementById("flow-" + kind);
        var data = document.getElementById("data-" + kind);
        return function (event) {
          var json = JSON.parse(event.data);
          showText(text, json);
          showFlow(flow, json);
          showData(data, json);
        }
      }

      var showText = function (elem, json) {
        var code = '<ol>';
        for (text of json.text.complete) {
          code += '<li class="complete">' + text + '</li>';
        }
        for (text of json.text.expected) {
          code += '<li class="expected">' + text + '</li>';
        }
        for (text of json.text.incoming) {
          code += '<li class="incoming">' + text + '</li>';
        }
        code += '</ol>';
        elem.innerHTML = code;
      }

      var showFlow = function (elem, json) {
      }

      var showData = function (elem, json) {
        elem.innerHTML = "<code>" + JSON.stringify(json.data) + "</code>";
      }

      events.onmessage = function (event) {
         listen("en")(event);
         listen("cs")(event);
      }
      events.addEventListener("cs", listen("cs"));
      events.addEventListener("en", listen("en"));
    </script>

  </body>
</html>
