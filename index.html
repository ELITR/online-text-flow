<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>ELITR Online Text Flow</title>
    <style>
      .row {
        display: flex;
      }

      .column {
        flex: 50%;
      }

      .complete {
        color: black;
      }

      .expected {
        color: gray;
      }

      .incoming {
        color: silver;
      }

      /*
      ol.reverse {
        display: flex;
        flex-direction: column-reverse;
      }
      */

      li {
        flex: 0 0 auto;
      }
    </style>
  </head>
  <body>

    <div class="row">

      <div class="column">
        <h1>EN</h1>
        <div id="text-en"><p><em>no events yet</em></p></div>
      </div>

      <div class="column">
        <h1>CS</h1>
        <div id="text-cs"><p><em>no events yet</em></p></div>
      </div>

    </div>

    <script>
      var events = new EventSource("{{ data }}");

      var listen = function (kind) {
        var text = document.getElementById("text-" + kind);
        return function (event) {
          var json = JSON.parse(event.data);
          show(text, json);
        }
      }

      var keep = ''

      var show = function (elem, json) {
        var code = '<ol class="reverse">';
        for (text of json.text.complete) {
          keep += '<li class="complete">' + text + '</li>';
        }
        code += keep;
        for (text of json.text.expected) {
          code += '<li class="expected">' + text + '</li>';
        }
        for (text of json.text.incoming) {
          code += '<li class="incoming">' + text + '</li>';
        }
        code += '</ol>';
        elem.innerHTML = code;
      }

      events.onmessage = function (event) {
         listen("en")(event);
         listen("cs")(event);
      }
      events.addEventListener("cs", listen("cs"));
      events.addEventListener("en", listen("en"));
    </script>

  </body>
</html>
